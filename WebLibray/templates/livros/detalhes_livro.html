{% extends "base.html" %}

{% block title %}{{ livro[1] }} - Detalhes do Livro{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('livros.ver_livros') }}">Catálogo</a></li>
                <li class="breadcrumb-item active">{{ livro[1] }}</li>
            </ol>
        </nav>
    </div>
    
    <div class="row">
        <!-- Book Cover and Actions -->
        <div class="col-lg-4 col-md-5 mb-4">
            <div class="book-detail-card">
                <div class="book-cover-large">
                    {% if livro[5] %}
                        <img src="{{ url_for('static', filename=livro[5]) }}" alt="{{ livro[1] }}">
                    {% else %}
                        <div class="cover-placeholder-large">
                            <i class="fas fa-book"></i>
                        </div>
                    {% endif %}
                </div>
                
                <div class="book-status-badge">
                    <span class="badge badge-lg badge-{% if livro[6] == 'disponivel' %}success{% else %}warning{% endif %}">
                        <i class="fas fa-{% if livro[6] == 'disponivel' %}check-circle{% else %}clock{% endif %}"></i>
                        {{ 'Disponível' if livro[6] == 'disponivel' else 'Emprestado' }}
                    </span>
                </div>
                
                <!-- Action Buttons -->
                <div class="book-actions mt-3">
                    {% if session.user_type in ['aluno', 'professor'] and livro[6] == 'disponivel' %}
                        <form method="POST" action="{{ url_for('emprestimos.solicitar_emprestimo', livro_id=livro[0]) }}">
                            <button type="submit" class="btn btn-success btn-lg w-100 mb-2">
                                <i class="fas fa-handshake"></i> Solicitar Empréstimo
                            </button>
                        </form>
                    {% elif session.user_type in ['aluno', 'professor'] and livro[6] != 'disponivel' %}
                        <button class="btn btn-secondary btn-lg w-100 mb-2" disabled>
                            <i class="fas fa-ban"></i> Indisponível
                        </button>
                    {% endif %}
                    
                    {% if session.user_type == 'admin' %}
                        <div class="admin-actions">
                            <a href="{{ url_for('livros.editar_livro', id=livro[0]) }}" 
                               class="btn btn-primary w-100 mb-2">
                                <i class="fas fa-edit"></i> Editar Livro
                            </a>
                            <form method="POST" action="{{ url_for('livros.delete_livro', id=livro[0]) }}" 
                                  onsubmit="return confirm('Tem certeza de que deseja eliminar este livro? Esta ação não pode ser desfeita.')">
                                <button type="submit" class="btn btn-danger w-100">
                                    <i class="fas fa-trash"></i> Eliminar Livro
                                </button>
                            </form>
                        </div>
                    {% endif %}
                    
                    <button class="btn btn-outline w-100 mt-2" onclick="window.history.back()">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Book Information -->
        <div class="col-lg-8 col-md-7">
            <div class="book-info-card">
                <div class="book-title">
                    <h1>{{ livro[1] }}</h1>
                    <p class="book-author">por <strong>{{ livro[2] }}</strong></p>
                </div>
                
                <div class="book-details">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="detail-item">
                                <span class="detail-label">Categoria:</span>
                                <span class="detail-value">
                                    <span class="category-badge">{{ livro[3] }}</span>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value">
                                    <span class="status-indicator status-{{ livro[6] }}">
                                        {{ 'Disponível' if livro[6] == 'disponivel' else 'Emprestado' }}
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    {% if livro[4] %}
                    <div class="detail-item description">
                        <span class="detail-label">Descrição:</span>
                        <div class="detail-value">
                            <p>{{ livro[4] }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Additional Information -->
                    <div class="additional-info">
                        <h3>Informações Adicionais</h3>
                        <div class="row">
                            <div class="col-md-6">
                                {% if livro[7] %}
                                <div class="info-item">
                                    <i class="fas fa-barcode"></i>
                                    <span class="info-label">ISBN:</span>
                                    <span class="info-value">{{ livro[7] }}</span>
                                </div>
                                {% endif %}
                                
                                {% if livro[8] %}
                                <div class="info-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span class="info-label">Ano:</span>
                                    <span class="info-value">{{ livro[8] }}</span>
                                </div>
                                {% endif %}
                                
                                {% if livro[9] %}
                                <div class="info-item">
                                    <i class="fas fa-building"></i>
                                    <span class="info-label">Editora:</span>
                                    <span class="info-value">{{ livro[9] }}</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                {% if livro[10] %}
                                <div class="info-item">
                                    <i class="fas fa-file-alt"></i>
                                    <span class="info-label">Páginas:</span>
                                    <span class="info-value">{{ livro[10] }}</span>
                                </div>
                                {% endif %}
                                
                                {% if livro[11] %}
                                <div class="info-item">
                                    <i class="fas fa-globe"></i>
                                    <span class="info-label">Idioma:</span>
                                    <span class="info-value">{{ livro[11] }}</span>
                                </div>
                                {% endif %}
                                
                                <div class="info-item">
                                    <i class="fas fa-clock"></i>
                                    <span class="info-label">Adicionado:</span>
                                    <span class="info-value">{{ livro[12].strftime('%d/%m/%Y') if livro[12] else 'N/A' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Loan History (Admin Only) -->
            {% if session.user_type == 'admin' and historico_emprestimos %}
            <div class="loan-history-card mt-4">
                <h3>Histórico de Empréstimos</h3>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Utilizador</th>
                                <th>Data Empréstimo</th>
                                <th>Data Devolução</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for emprestimo in historico_emprestimos %}
                            <tr>
                                <td>{{ emprestimo[1] }}</td>
                                <td>{{ emprestimo[2].strftime('%d/%m/%Y') if emprestimo[2] else '-' }}</td>
                                <td>{{ emprestimo[3].strftime('%d/%m/%Y') if emprestimo[3] else '-' }}</td>
                                <td>
                                    <span class="badge badge-{% if emprestimo[4] == 'devolvido' %}success{% elif emprestimo[4] == 'em_atraso' %}danger{% else %}warning{% endif %}">
                                        {{ emprestimo[4].replace('_', ' ').title() }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.breadcrumb {
    background: transparent;
    padding: 0;
    margin-bottom: 1rem;
}

.breadcrumb-item + .breadcrumb-item::before {
    content: ">";
    color: #6c757d;
}

.breadcrumb-item a {
    color: var(--primary-color);
    text-decoration: none;
}

.breadcrumb-item a:hover {
    color: var(--accent-3);
}

.book-detail-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow);
    text-align: center;
    position: sticky;
    top: 2rem;
}

.book-cover-large {
    width: 100%;
    max-width: 300px;
    height: 400px;
    margin: 0 auto 1.5rem;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    position: relative;
}

.book-cover-large img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.cover-placeholder-large {
    width: 100%;
    height: 100%;
    background: var(--light-gray);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    font-size: 4rem;
}

.book-status-badge {
    margin-bottom: 1rem;
}

.badge-lg {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
}

.book-info-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow);
}

.book-title {
    margin-bottom: 2rem;
}

.book-title h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--accent-1);
    margin-bottom: 0.5rem;
    line-height: 1.2;
}

.book-author {
    font-size: 1.25rem;
    color: var(--primary-color);
    margin: 0;
}

.book-details {
    margin-bottom: 2rem;
}

.detail-item {
    margin-bottom: 1.5rem;
}

.detail-item.description {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #dee2e6;
}

.detail-label {
    font-weight: 600;
    color: var(--accent-1);
    display: block;
    margin-bottom: 0.5rem;
}

.detail-value {
    color: #495057;
    line-height: 1.6;
}

.category-badge {
    background: var(--primary-color);
    color: var(--white);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    font-weight: 500;
    font-size: 0.875rem;
}

.status-indicator {
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 0.875rem;
}

.status-disponivel {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.status-emprestado {
    background: rgba(255, 193, 7, 0.1);
    color: #ffc107;
}

.additional-info {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #dee2e6;
}

.additional-info h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--accent-1);
    margin-bottom: 1.5rem;
}

.info-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.75rem 0;
}

.info-item i {
    width: 20px;
    color: var(--primary-color);
    margin-right: 1rem;
}

.info-label {
    font-weight: 500;
    color: var(--accent-1);
    margin-right: 0.5rem;
    min-width: 80px;
}

.info-value {
    color: #495057;
}

.admin-actions {
    margin-bottom: 1rem;
}

.loan-history-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow);
}

.loan-history-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--accent-1);
    margin-bottom: 1.5rem;
}

.table {
    margin-bottom: 0;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: var(--accent-1);
    background: var(--light-gray);
}

.table td {
    vertical-align: middle;
}

@media (max-width: 992px) {
    .book-detail-card {
        position: static;
        margin-bottom: 2rem;
    }
}

@media (max-width: 768px) {
    .book-title h1 {
        font-size: 2rem;
    }
    
    .book-author {
        font-size: 1.1rem;
    }
    
    .book-cover-large {
        height: 300px;
    }
    
    .cover-placeholder-large {
        font-size: 3rem;
    }
    
    .book-detail-card,
    .book-info-card,
    .loan-history-card {
        padding: 1.5rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate elements on page load
    const elements = document.querySelectorAll('.book-detail-card, .book-info-card, .loan-history-card');
    elements.forEach((element, index) => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            element.style.transition = 'all 0.6s ease';
            element.style.opacity = '1';
            element.style.transform = 'translateY(0)';
        }, 200 * index);
    });
    
    // Handle loan request
    const loanForm = document.querySelector('form[action*="solicitar_emprestimo"]');
    if (loanForm) {
        loanForm.addEventListener('submit', function(e) {
            const confirmed = confirm('Deseja solicitar o empréstimo deste livro?');
            if (!confirmed) {
                e.preventDefault();
            }
        });
    }
    
    // Smooth scroll for long content
    if (window.location.hash) {
        const target = document.querySelector(window.location.hash);
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
        }
    }
});
</script>
{% endblock %} 