{% extends "base.html" %}

{% block title %}Dashboard Admin - Biblioteca{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">Dashboard Administrativo</h1>
        <p class="page-subtitle">Visão geral do sistema de biblioteca</p>
    </div>
    
    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-book"></i>
            </div>
            <div class="stat-number">{{ total_livros }}</div>
            <div class="stat-label">Total de Livros</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-number">{{ total_utilizadores }}</div>
            <div class="stat-label">Utilizadores</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-handshake"></i>
            </div>
            <div class="stat-number">{{ emprestimos_ativos }}</div>
            <div class="stat-label">Empréstimos Ativos</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-number">{{ emprestimos_atrasados }}</div>
            <div class="stat-label">Em Atraso</div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Ações Rápidas</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <a href="{{ url_for('livros.add_livro') }}" class="btn btn-primary w-100">
                                <i class="fas fa-plus"></i>
                                Adicionar Livro
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{{ url_for('admin.add_utilizador') }}" class="btn btn-secondary w-100">
                                <i class="fas fa-user-plus"></i>
                                Novo Utilizador
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{{ url_for('admin.relatorios') }}" class="btn btn-outline w-100">
                                <i class="fas fa-chart-bar"></i>
                                Relatórios
                            </a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <a href="{{ url_for('livros.ver_livros') }}" class="btn btn-outline w-100">
                                <i class="fas fa-book-open"></i>
                                Gerir Livros
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{{ url_for('admin.gerir_utilizadores') }}" class="btn btn-outline w-100">
                                <i class="fas fa-users-cog"></i>
                                Gerir Utilizadores
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{{ url_for('emprestimos.ver_emprestimos') }}" class="btn btn-outline w-100">
                                <i class="fas fa-list"></i>
                                Ver Empréstimos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Estado do Sistema</h3>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>Livros Disponíveis</span>
                        <span class="badge badge-success">{{ total_livros - emprestimos_ativos }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>Livros Emprestados</span>
                        <span class="badge badge-info">{{ emprestimos_ativos }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>Empréstimos Atrasados</span>
                        <span class="badge badge-danger">{{ emprestimos_atrasados }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Taxa de Utilização</span>
                        <span class="badge badge-warning">
                            {% if total_livros > 0 %}
                                {{ "%.1f"|format((emprestimos_ativos / total_livros) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts and Recent Activity -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Empréstimos por Mês</h3>
                </div>
                <div class="card-body">
                    <div id="monthlyChart" class="simple-chart" 
                         data-data='[
                             {"label": "Jan", "value": 45},
                             {"label": "Fev", "value": 52},
                             {"label": "Mar", "value": 38},
                             {"label": "Abr", "value": 64},
                             {"label": "Mai", "value": 71},
                             {"label": "Jun", "value": 56}
                         ]'>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Atividade Recente</h3>
                </div>
                <div class="card-body">
                    <div class="activity-timeline">
                        <div class="activity-item">
                            <div class="activity-icon bg-success">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="activity-content">
                                <p><strong>Novo livro adicionado</strong></p>
                                <small class="text-muted">Há 2 horas</small>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-icon bg-info">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="activity-content">
                                <p><strong>Livro emprestado</strong></p>
                                <small class="text-muted">Há 3 horas</small>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-icon bg-warning">
                                <i class="fas fa-undo"></i>
                            </div>
                            <div class="activity-content">
                                <p><strong>Livro devolvido</strong></p>
                                <small class="text-muted">Há 5 horas</small>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-icon bg-primary">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="activity-content">
                                <p><strong>Novo utilizador registado</strong></p>
                                <small class="text-muted">Há 1 dia</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Alerts and Notifications -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Alertas e Notificações</h3>
                </div>
                <div class="card-body">
                    {% if emprestimos_atrasados > 0 %}
                    <div class="alert alert-warning">
                        <div class="alert-content">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>
                                <strong>Atenção!</strong> 
                                Existem {{ emprestimos_atrasados }} empréstimo{% if emprestimos_atrasados != 1 %}s{% endif %} em atraso. 
                                <a href="{{ url_for('emprestimos.ver_emprestimos') }}?status=atrasado">Ver detalhes</a>
                            </span>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="alert alert-info">
                        <div class="alert-content">
                            <i class="fas fa-info-circle"></i>
                            <span>
                                <strong>Dica:</strong> 
                                Use os relatórios para acompanhar as tendências de utilização da biblioteca.
                            </span>
                        </div>
                    </div>
                    
                    <div class="alert alert-success">
                        <div class="alert-content">
                            <i class="fas fa-check-circle"></i>
                            <span>
                                <strong>Sistema operacional!</strong> 
                                Todos os serviços estão funcionando normalmente.
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.activity-timeline {
    padding: 1rem 0;
}

.activity-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #e9ecef;
}

.activity-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    margin-right: 1rem;
    flex-shrink: 0;
}

.activity-content {
    flex: 1;
}

.activity-content p {
    margin: 0 0 0.25rem 0;
    color: var(--accent-1);
}

.bg-success { background: var(--success); }
.bg-info { background: var(--info); }
.bg-warning { background: var(--warning); }
.bg-primary { background: var(--primary-color); }

.simple-chart {
    display: flex;
    align-items: flex-end;
    justify-content: space-around;
    height: 200px;
    padding: 1rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Update statistics periodically
function updateStats() {
    fetch('/api/admin/stats')
        .then(response => response.json())
        .then(data => {
            // Update stats if needed
            console.log('Stats updated:', data);
        })
        .catch(error => console.error('Error updating stats:', error));
}

// Update every 5 minutes
setInterval(updateStats, 300000);

// Load activity timeline
document.addEventListener('DOMContentLoaded', function() {
    // Add animation to activity items
    const items = document.querySelectorAll('.activity-item');
    items.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            item.style.transition = 'all 0.5s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, 100 * index);
    });
});
</script>
{% endblock %} 